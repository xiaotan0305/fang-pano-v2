(function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("pano",[],e):"object"==typeof exports?exports.pano=e():t.pano=e()})(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([,function(t,e,i){function n(){di=!1,ci=!0,a(),E(),m(),ji||f(),b(),V(),jt()}function o(){a(),v(),E(),m(),ot(),f(),b();var t=T();gt("init3DHouse,isLandscape: "+t),st(t),lt(t),A(),jt()}function a(){Qt=te=425,ie=30,pe=window.innerWidth,ve=window.innerHeight,Ie=d(),Ft=new THREE.TextureLoader,Lt=new THREE.Raycaster,Ct=new THREE.Vector2,zt=new THREE.Scene;var t=new THREE.SphereBufferGeometry(3e3,1,1),e=new THREE.MeshPhongMaterial({color:3948353,specular:1118481,side:THREE.BackSide});Vt=new THREE.Mesh(t,e),zt.add(Vt),Ot=new THREE.PerspectiveCamera(ui,pe/ve,.5,1e5),Ot.rotation.reorder("YXZ"),zt.add(Ot),se=!1,re=2,ji||(he=new THREE.Scene,he.visible=!1,Ee=new THREE.PerspectiveCamera(35,Qt/te,.5,1e5),Ee.rotation.reorder("YXZ"),Ee.position.z=1,At=new THREE.Scene,At.visible=!1,Gt=new THREE.OrthographicCamera(-pe/2,pe/2,ve/2,-ve/2,1,10),Gt.position.z=10,Wt=new THREE.Group,At.add(Wt),Xt=new THREE.Group,At.add(Xt)),Nt=new THREE.WebGLRenderer,Nt.antialias=!0,Nt.sortObjects=!1,Nt.setPixelRatio(Ie?4:2),Nt.setSize(pe,ve),Nt.gammaInput=!0,Nt.gammaOutput=!0,Nt.autoClear=!1,ei.appendChild(Nt.domElement),Ye&&(Bt=new Stats,ei.appendChild(Bt.dom)),Ne=new THREE.VRControls(Ot),Fe=new THREE.StereoEffect(Nt),Fe.setSize(pe,ve),h(),c()}function r(){fe.rotation.x=.5,ge=.7,be=-30,ye=-.5,we=-38/13,Te=13;var t=Dt+We+"/FloorPlans/"+We+".png";Ft.load(t,s),Ut=new THREE.Group,Ut.visible=!1,Wt.add(Ut),Yt=bt("",{fontsize:50,backgroundColor:{r:0,g:0,b:0,a:.498039},cornerAngle:12}),Yt.scale.set(210,30,1),Yt.visible=!1,Ut.add(Yt)}function s(t){var e=500/Math.max(xe.x,xe.z),i=.0011*e;fe.scale.set(i,i,i);var n=1.1*e;Ut.scale.set(n,n,n),Ft.load("http://ocnvj4kt8.bkt.clouddn.com/pano/textures/button_Auto.png"),Ft.load("http://ocnvj4kt8.bkt.clouddn.com/pano/textures/button_2D_pressed.png"),Ft.load("http://ocnvj4kt8.bkt.clouddn.com/pano/textures/button_3D_pressed.png");var o=Ft.load("http://ocnvj4kt8.bkt.clouddn.com/pano/textures/button_Auto_pressed.png"),a=new THREE.SpriteMaterial({map:o});ue=new THREE.Sprite(a),ue.scale.set(50,25,1),S(ue,U),Xt.add(ue);var r=Ft.load("http://ocnvj4kt8.bkt.clouddn.com/pano/textures/button_2D.png"),s=new THREE.SpriteMaterial({map:r});de=new THREE.Sprite(s),de.scale.set(40,25,1),S(de,X),Xt.add(de);var d=Ft.load("http://ocnvj4kt8.bkt.clouddn.com/pano/textures/button_3D.png"),c=new THREE.SpriteMaterial({map:d});ce=new THREE.Sprite(c),ce.scale.set(40,25,1),S(ce,Y),Xt.add(ce);var u=Ft.load("http://ocnvj4kt8.bkt.clouddn.com/pano/textures/sector.png"),m=new THREE.SpriteMaterial({map:u});$t=new THREE.Sprite(m),$t.scale.set(100,100,1),$t.material.opacity=.5,Ut.add($t),le=Ot.rotation.y;var p=Ft.load("http://ocnvj4kt8.bkt.clouddn.com/pano/textures/hotSpotPoint.png"),v=new THREE.SpriteMaterial({map:p});for(var h in li){var E=li[h].tag,f=new THREE.Sprite(v);f.tag=E,f.name=li[h].tagName,f.material.opacity=.7,f.scale.set(30,30,1),f.position.set(li[h].position.x*ge,-li[h].position.z*ge,1),E.floorPlanPosition=f.position.clone(),S(f,function(t){kt(t.tag.thumbnailElement,!0)}),Ut.add(f)}var g=new THREE.SpriteMaterial({map:t});Zt=new THREE.Sprite(g);var b=.8*e;Zt.scale.set(xe.x*b,xe.z*b,1),Zt.material.opacity=.9,Zt.visible=!1,Wt.add(Zt);var y=Ft.load("http://ocnvj4kt8.bkt.clouddn.com/pano/textures/bg.png",function(){At.visible=!0;for(var t in Re.Rooms){var e=Re.Rooms[t];for(var i in e.RoomFaces){rt(e.RoomFaces[i],He.children[t],fe.children[t])}}}),w=new THREE.SpriteMaterial({map:y});Kt=new THREE.Sprite(w),Kt.material.opacity=.5,Kt.material.color=16777215,Kt.scale.set(Qt,ie,1),Xt.add(Kt);var T=new THREE.SpriteMaterial({map:y});Jt=new THREE.Sprite(T),Jt.material.opacity=.5,Jt.material.color=0,Jt.scale.set(Qt,te,1),S(Jt,I),Wt.add(Jt),l();for(var h in li)if(li[h].tag==_e){Yt.position.set(li[h].tag.floorPlanPosition.x+Te,li[h].tag.floorPlanPosition.y+Te*we,1),wt(Yt,li[h].tag.Name.split("-")[0]),$t.position.set(li[h].position.x*ge,-li[h].position.z*ge,1);break}et(!0)}function l(){pe=window.innerWidth,ve=window.innerHeight,ee=pe/Qt*.4,pe>ve&&(ee=ve/te*.4),Wt.scale.set(ee,ee,1),Wt.position.set((Qt*ee-pe)/2,(ve-te*ee)/2,1),void 0!=Kt&&(Kt.scale.set(Qt*ee,ie,1),ce.position.set((Qt*ee-25-20)/2,0,1),de.position.set(ce.position.x-45,0,1),ue.position.set(de.position.x-50,0,1)),Xt.position.set((Qt*ee-pe)/2,ve/2-te*ee-ie/2-.5,1)}function d(){var t=navigator.userAgent.toLowerCase(),e="ipad"==t.match(/ipad/i),i="iphone os"==t.match(/iphone os/i),n="midp"==t.match(/midp/i),o="rv:1.2.3.4"==t.match(/rv:1.2.3.4/i),a="ucweb"==t.match(/ucweb/i),r="android"==t.match(/android/i),s="windows ce"==t.match(/windows ce/i),l="windows mobile"==t.match(/windows mobile/i);return e||i||n||o||a||r||s||l}function c(){pe==window.innerWidth&&ve==window.innerHeight||(pe=window.innerWidth,ve=window.innerHeight,gt("R_SCREEN_WIDTH:"+pe),gt("R_SCREEN_HEIGHT"+ve),g()),Ye&&Bt.update(),Z(),Ot.updateProjectionMatrix(),requestAnimationFrame(c);for(var t in li)li[t].rotation.y=Ot.rotation.y;if(void 0!=fe&&he.visible&&(Qe?fe.rotation.y-=.0025:fe.rotation.y=-Ot.rotation.y),Zt&&(le!=Ot.rotation.y&&Ke&&!di&&(le=Ot.rotation.y,tt(),Q(),et(!0)),Zt.visible)){$t.material.rotation=Ot.rotation.y-.6,Lt.setFromCamera(Ct,Gt);var e=Lt.intersectObjects(ri);e.length>0&&void 0!=e[0].object.tag?(qt=e[0].object,Yt.position.set(qt.position.x+Te,qt.position.y+Te*we,1),wt(Yt,qt.name)):void 0!=_e&&(Yt.position.set(_e.floorPlanPosition.x+Te,_e.floorPlanPosition.y+Te*we,1),wt(Yt,_e.Name.split("-")[0]))}Nt.clear(),Nt.clearDepth(),Pi?(Mi||Ne.update(),Si?(Fe.render(zt,Ot),k()):u()):(u(),Pe.enabled&&Pe.update())}function u(){ji?Nt.render(zt,Ot):(Nt.setViewport(0,ve-te*ee,Qt*ee,te*ee),Nt.render(he,Ee),Nt.setViewport(0,0,pe,ve),Nt.render(zt,Ot),Nt.render(At,Gt))}function m(){Ve=new THREE.Mesh(new THREE.RingGeometry(.02,.04,32),new THREE.MeshBasicMaterial({color:16777215,opacity:.5,transparent:!0})),Ve.visible=!1,Ve.position.z=-2,Ot.add(Ve)}function p(t){for(var e in si)si[e].visible=t;if(t&&ki){var i=$("#thumbnail-list").children("#thumbnail");for(var e in i)if(i[e].thumbnailData.isSelected){i[e].onclick();break}}}function v(){var t;zt.add(new THREE.AmbientLight(6710886)),t=new THREE.DirectionalLight(14674943,.3),t.position.set(0,200,0),t.position.multiplyScalar(1.3),t.castShadow=!0,t.shadow.mapSize.width=1024,t.shadow.mapSize.height=1024;var e=300;t.shadow.camera.left=-e,t.shadow.camera.right=e,t.shadow.camera.top=e,t.shadow.camera.bottom=-e,t.shadow.camera.far=1e3,zt.add(t)}function h(){oe=!1,ne=2.5,Pe=new THREE.OrbitControls(Ot,Nt.domElement),Pe.maxPolarAngle=THREE.Math.degToRad(90),Pe.minPolarAngle=THREE.Math.degToRad(10),Pe.autoRotate=xi,Pe.autoRotateSpeed=1,Pe.zoomSpeed=.5,Pe.enableDamping=!0,Pe.dampingFactor=.8,Me=new It(Ot,Nt.domElement),Me.enabled=!1}function E(){for(var t=[],e=0;e<6;e++)t.push(new THREE.MeshBasicMaterial({side:THREE.BackSide}));ke=new THREE.Mesh(new THREE.CubeGeometry(5e3,5e3,5e3),new THREE.MultiMaterial(t)),ke.visible=!1,Vt.visible=!0;var i=Ft.load("http://ocnvj4kt8.bkt.clouddn.com/pano/textures/logo.png");i.minFilter=THREE.NearestFilter;var n=new THREE.PlaneBufferGeometry(300,300,1,1),o=new THREE.MeshBasicMaterial({map:i,transparent:!0});Se=new THREE.Mesh(n,o),Se.rotation.x=THREE.Math.degToRad(270),Se.position.y=-400,ke.add(Se),zt.add(ke)}function f(){var t=Ft.load("http://ocnvj4kt8.bkt.clouddn.com/pano/textures/hotspot/feet.png"),e=Ft.load("http://ocnvj4kt8.bkt.clouddn.com/pano/textures/hotspot_sprite.png");t.minFilter=THREE.NearestFilter;var i=new THREE.MeshBasicMaterial({map:t,transparent:!0}),n=4.5-Re.CameraHeight,o=Ft.load("http://ocnvj4kt8.bkt.clouddn.com/pano/textures/hotspot/light.png");o.minFilter=THREE.NearestFilter;var a=new THREE.CylinderGeometry(12,12,70,30,1,!0),r=new THREE.MeshBasicMaterial({map:o,transparent:!0,depthWrite:!1,side:THREE.DoubleSide}),s=[];for(var l in Re.HotSpots){var d=Re.HotSpots[l],c=new THREE.Group,u=new THREE.Vector3(d.Position.x,d.Position.y+n,-d.Position.z);c.position.copy(u),zt.add(c),li.push(c),d.gameObject=c,c.tag=d;var m=d.Name;"Door"==d.Type&&d.Name.split("-").length>2&&(m=d.Name.substring(0,d.Name.lastIndexOf("-"))),"Room"==d.Type&&d.Name.split("-").length>1&&(m=d.Name.split("-")[0]),c.tagName=m,d.IsSecondFloor=d.Position.y>100;var p=new THREE.Mesh(a,r);c.add(p),c.lightObj=p,p.position.set(0,35,0),p.name=d.Name,x(p,function(t){kt(t.parent.tag.thumbnailElement,!0)});var v=new THREE.SpriteMaterial({opacity:0}),h=new THREE.Sprite(v);c.add(h),c.clickableGroup=h,h.position.set(0,p.position.y,0);var E=Rt(e);h.add(E),E.position.set(0,0,0),E.visible=!1,c.circleSprite=E;var f=new THREE.PlaneBufferGeometry(12,12,1,1),g=new THREE.Mesh(f,i);if(g.rotation.x=THREE.Math.degToRad(270),g.position.y=-35,p.add(g),!(m.split("-").length>1||W(s,m))){var b=bt(m,{fontsize:50,backgroundColor:{r:0,g:0,b:0,a:.498039},cornerAngle:12});h.add(b),b.y=6,b.position.set(0,b.y,0),b.name=d.Name+ni,b.visible=!1,c.hotSpotNameSprite=b,s.push(m),x(b,function(t){kt(t.parent.parent.tag.thumbnailElement,!0)});var y=bt(m,{fontsize:250,backgroundColor:{r:0,g:0,b:0,a:.498039},cornerAngle:40});c.add(y),y.position.set(0,p.position.y+40,0),y.name=d.Name+ii,c.overviewHotSpotNameSprite=y,x(y,L);var w=new THREE.LineBasicMaterial({color:32768,linewidth:1}),T=new THREE.Geometry;T.vertices.push(new THREE.Vector3(0,g.position.y,0),new THREE.Vector3(0,p.position.y-7));var R=new THREE.Line(T,w);R.name=oi,c.nameLine=R,p.add(R)}}}function g(){gt("resizeWindow"),pe=window.innerWidth,ve=window.innerHeight,gt("SCREEN_WIDTH:"+pe),gt("SCREEN_HEIGHT"+ve),Ot.aspect=pe/ve,Ot.updateProjectionMatrix(),ji||(Ee.aspect=Qt/te,Ee.updateProjectionMatrix(),Gt.left=-pe/2,Gt.right=pe/2,Gt.top=ve/2,Gt.bottom=-ve/2,Gt.updateProjectionMatrix(),l()),Si?Fe.setSize(pe,ve):Nt.setSize(pe,ve)}function b(){Nt.domElement.addEventListener("touchstart",H,!1),Nt.domElement.addEventListener("touchend",H,!1),Nt.domElement.addEventListener("mousedown",H,!1),Nt.domElement.addEventListener("mouseup",H,!1),window.addEventListener("mousemove",R,!1),window.addEventListener("orientationchange",y,!1)}function y(){gt("onOrientionChangeDelay"),w()}function w(t){var e=T();if(gt("onOrientionChange,isLandscape: "+e),void 0!=e){st(e),Pi&&(e?Si||ht(!0):Si&&ht(!1));var i=document.getElementById("thumbnail-list");if(e)for(var n in i.children)i.children[n].classList.remove("col-xs-3"),i.children[n].classList.add("col-xs-2");else for(var n in i.children)i.children[n].classList.remove("col-xs-2"),i.children[n].classList.add("col-xs-3")}}function T(){var t;return 180==window.orientation||0==window.orientation?t=!1:90!=window.orientation&&-90!=window.orientation||(t=!0),t}function R(t){t.preventDefault(),Ct.x=t.clientX/Nt.domElement.clientWidth*2-1,Ct.y=-t.clientY/Nt.domElement.clientHeight*2+1}function H(t){if("touchstart"==t.type||"mousedown"==t.type)Be=(new Date).getTime(),Ze=!0,ji||(Le=P(t)),di&&(Pe.autoRotate=!1);else if("touchend"==t.type||"mouseup"==t.type){if(Ze=!1,(new Date).getTime()-Be<200&&!ji){var e=P(t);e==Le&&void 0!=Le&&Le.onClick(Le)}di?(void 0!=ze&&clearTimeout(ze),ze=setTimeout(function(){Pe.autoRotate=xi},3e3)):!Qe&&Ke&&Q()}}function x(t,e){ai.push(t),t.onClick=e}function S(t,e){ri.push(t),t.onClick=e}function P(t){var e;t.preventDefault();var i,n;"touchstart"==t.type?(i=t.touches[0].pageX,n=t.touches[0].pageY):"touchend"==t.type?(i=t.changedTouches[0].pageX,n=t.changedTouches[0].pageY):(i=t.clientX,n=t.clientY),Ct.x=i/Nt.domElement.clientWidth*2-1,Ct.y=-n/Nt.domElement.clientHeight*2+1,Lt.setFromCamera(Ct,Gt);var o=Lt.intersectObjects(ri);return o.length>0&&At.visible&&(Zt.visible&&void 0!=o[0].object.tag||void 0==o[0].object.tag)?e=o[0].object:(Lt.setFromCamera(Ct,Ot),o=Lt.intersectObjects(ai),o.length>0&&(e=o[0].object)),e}function M(){var t;Lt.setFromCamera({x:0,y:0},Ot);var e=Lt.intersectObjects(ai);return e.length>0&&(t=e[0].object),t}function k(){var t=M();Ge!=t&&(void 0!=Ae&&clearTimeout(Ae),void 0!=t&&(Ae=setTimeout(function(){t.onClick(t)},1500)),Ge=t)}function j(){kt(De.thumbnailElement,!0)}function I(){if(!Zt.visible){Ke&&tt(),ki?document.getElementById("thumbnail-controller").style.visibility="visible":(document.getElementById("thumbnail-controller").style.visibility="hidden",nt()),Ei.style.visibility="visible",pi.style.visibility="hidden",vi.style.visibility="hidden",gi.style.visibility="visible",fi.style.visibility="hidden",_e=null,Ot.position.copy(je),Ot.fov=Si?mi:75,Ot.updateProjectionMatrix(),F(),B(!0),D();for(var t in li){li[t].scale.set(1,1,1)}Pe.enabled=!0,Pe.autoRotate=xi,Pe.update(),Me.enabled=!1,ke.visible=!1,Vt.visible=!0,He.visible=!0,Ri=!0;for(var t in li)li[t].visible=!0;p(!0),di=!0}}function _(){document.getElementById("thumbnail-controller").style.visibility="visible",Ei.style.visibility="hidden",pi.style.visibility="visible",vi.style.visibility="visible",gi.style.visibility="hidden",fi.style.visibility="visible",B(!1);for(var t in li)li[t].visible=!1;Pe.enabled=!1,Pe.autoRotate=!1,Me.enabled=!0,je=new THREE.Vector3(Ot.position.x,Ot.position.y,Ot.position.z),Ot.rotation.x=0,ke.visible=!0,Vt.visible=!1,!ji&&Zt&&(At.visible=!0,et(Zt.visible)),Ke&&Q(),ci||(He.visible=!1),p(!1),di=!1}function D(){for(var t in li)li[t].lightObj.visible=!0,li[t].circleSprite.visible=!1,li[t].nameLine.visible=!0}function B(t){for(var e in li){var i=li[e].overviewHotSpotNameSprite;if(void 0!=i&&(i.visible=t,li[e].nameLine=t),t){var n=li[e].hotSpotNameSprite;n&&(n.visible=!1)}}}function L(t){kt(t.parent.tag.thumbnailElement,!0)}function C(t,e,i,n){if(console.log("fisrt:"+t.Name),Ri&&_e!=t){De=t,_e=t,Ri=!1,void 0!=t.cached&&0!=t.cached||(document.getElementById("loading").style.visibility="visible");var o;o=ji?t.ImagePath:t.ImagePath.substring(t.ImagePath.lastIndexOf("/")+1),o=o.substring(0,o.lastIndexOf("."));N([$e+o+"_l.jpg",$e+o+"_r.jpg",$e+o+"_u.jpg",$e+o+"_d.jpg",$e+o+"_f.jpg",$e+o+"_b.jpg"],function(i){O(i,t),e&&e()},function(t,e){i&&i(t,e)},function(t){Ri=!0,document.getElementById("loading").style.visibility="hidden",n&&n()})}}function z(t,e,i,n){console.log(t.Name);var o;o=ji?t.ImagePath:t.ImagePath.substring(t.ImagePath.lastIndexOf("/")+1),o=o.substring(0,o.lastIndexOf(".")),N([Xe+o+"_l.jpg",Xe+o+"_r.jpg",Xe+o+"_u.jpg",Xe+o+"_d.jpg",Xe+o+"_f.jpg",Xe+o+"_b.jpg"],function(t){F();for(var i=0;i<ke.material.materials.length;i++)ke.material.materials[i].map=t[i];e&&e()},function(t,e){i&&i(t,e)},function(t){Ri=!0,document.getElementById("loading").style.visibility="hidden",n&&n()})}function O(t,e){document.getElementById("loading").style.visibility="hidden",di&&_(),Ot.fov=Si?mi:ui,Me.updateRotation(),F();for(var i=0;i<ke.material.materials.length;i++)ke.material.materials[i].map=t[i];if(!ji){if(Yt){Yt.position.set(_e.floorPlanPosition.x+Te,_e.floorPlanPosition.y+Te*we,1),wt(Yt,_e.Name.split("-")[0]);for(var n in li)if(li[n].tag==_e){$t.position.set(li[n].position.x*ge,-li[n].position.z*ge,1);break}}var o=new THREE.Vector3(e.Position.x,e.Position.y,-e.Position.z);Ot.position.copy(o),Ot.updateProjectionMatrix(),ke.position.copy(o),ke.rotation.y=THREE.Math.degToRad(180-e.Rotation.y),G(e)}Ti&&(Ot.rotation.x=0,Ot.rotation.y=ke.rotation.y,Ot.rotation.z=0,Me.updateRotation(),Ti=!1),Ri=!0,e.cached=!0}function N(t,e,i,n){for(var o=[],a=0,r=0;r<t.length;r++)(function(r){Ft.load(t[r],function(i){o[r]=i,++a===t.length&&e&&e(o)},function(t){i&&i(r,t)},n)})(r)}function F(){for(var t=0;t<ke.material.materials.length;t++)null!=ke.material.materials[t].map&&(ke.material.materials[t].map.dispose(),ke.material.materials[t].map=null)}function V(t,e){var i;i=t?at(t):Re.HotSpots[0],e||(e=0),z(i,function(){hi.style.visibility="hidden",document.getElementById("welcome").style.visibility="hidden",_(),Ot.rotation.y=THREE.Math.degToRad(e),Me.updateRotation(),ki&&St(!0)},function(t,e){ti[t]=e.loaded/e.total;var i=0;for(var n in ti)void 0==ti[n]&&(ti[n]=0),i+=ti[n];var o=parseInt(i/6*100),a=document.getElementById("loading_progress_bar");a.style.width=o+"%",a.innerText=o+"%"},function(){$("#loading_tip").text("加载失败")}),document.getElementById("loading").style.visibility="hidden"}function A(){C(Re.HotSpots[0],mt,function(t,e){ti[t]=e.loaded/e.total;var i=0;for(var n in ti)void 0==ti[n]&&(ti[n]=0),i+=ti[n];var o=parseInt(i/6*100),a=document.getElementById("loading_progress_bar");a.style.width=o+"%",a.innerText=o+"%"},function(){$("#loading_tip").text("加载失败")}),document.getElementById("loading").style.visibility="hidden"}function G(t){var e=[];for(var i in t.VisibleHotSpots)e.push(at(t.VisibleHotSpots[i]));for(var i in li)if(t==li[i].tag)li[i].visible=!1;else{var n=W(e,li[i].tag);li[i].visible=n,li[i].lightObj.visible=!1,li[i].circleSprite.visible=n;var o=li[i].hotSpotNameSprite;if(!o)continue;if(o.visible=n,n){var a=Ot.position.distanceTo(li[i].position.clone().add(o.position)),r=.08*a;li[i].circleSprite.scale.set(r,r,r),r=.015*a;var o=li[i].hotSpotNameSprite;o.scale.set(o.material.map.scaleX*r,o.material.map.scaleY*r,1),o.position.y=o.y*r}}}function W(t,e){for(var i=t.length;i--;)if(t[i]===e)return!0;return!1}function X(){q(!1),et(!0),de.material.map=Ft.load("http://ocnvj4kt8.bkt.clouddn.com/pano/textures/button_2D_pressed.png"),ce.material.map=Ft.load("http://ocnvj4kt8.bkt.clouddn.com/pano/textures/button_3D.png")}function Y(){q(!1),et(!1),de.material.map=Ft.load("http://ocnvj4kt8.bkt.clouddn.com/pano/textures/button_2D.png"),ce.material.map=Ft.load("http://ocnvj4kt8.bkt.clouddn.com/pano/textures/button_3D_pressed.png")}function q(t){t?(ue.material.map=Ft.load("http://ocnvj4kt8.bkt.clouddn.com/pano/textures/button_Auto_pressed.png"),Q(),Ke=!0):(tt(),Ke=!1,ue.material.map=Ft.load("http://ocnvj4kt8.bkt.clouddn.com/pano/textures/button_Auto.png"))}function U(){Ke?(q(!1),Zt.visible?de.material.map=Ft.load("http://ocnvj4kt8.bkt.clouddn.com/pano/textures/button_2D_pressed.png"):ce.material.map=Ft.load("http://ocnvj4kt8.bkt.clouddn.com/pano/textures/button_3D_pressed.png")):(Zt.visible?de.material.map=Ft.load("http://ocnvj4kt8.bkt.clouddn.com/pano/textures/button_2D.png"):ce.material.map=Ft.load("http://ocnvj4kt8.bkt.clouddn.com/pano/textures/button_3D.png"),q(!0))}function Z(){oe&&(ne>0&&Ot.fov>=ae||ne<0&&Ot.fov<=ae?oe=!1:Ot.fov+=ne)}function J(){oe||(oe=!0,ae=Math.max(50,Math.min(100,Ot.fov-25)),ne>0&&(ne=-ne))}function K(){oe||(oe=!0,ae=Math.max(50,Math.min(100,Ot.fov+25)),ne<0&&(ne=-ne))}function Q(){void 0!=Oe&&clearTimeout(Oe),Oe=setTimeout(function(){Ze||(Qe=!0,et(!qe))},6e3)}function tt(){console.log("stopAutoPlay"),void 0!=Oe&&clearTimeout(Oe),Qe=!1}function et(t){ji||(Zt.visible=t,Ut.visible=t,he.visible=!t,me=!t)}function it(){}function nt(){he.visible=!1,At.visible=!1,tt()}function ot(){Ce=Re.HotSpots.length,He=new THREE.Object3D,He.name=Re.Name,zt.add(He),fe=He.clone(),he.add(fe);for(var t in Re.Rooms){var e=Re.Rooms[t],i=new THREE.Object3D;i.name=e.Name,i.position.set(e.Position.x,e.Position.y,-e.Position.z),i.rotation.set(0,THREE.Math.degToRad(-e.Rotation),0),He.add(i),si.push(i),e.gameObject=i,e.IsSecondFloor||(e.IsSecondFloor=e.Position.y>100);var n=i.clone();fe.add(n);for(var o in e.RoomFaces)Hi++}return He.scale.set(wi,wi,wi),xe=dt(Re),Re}function at(t){var e;for(var i in Re.HotSpots)if(Re.HotSpots[i].Name==t){e=Re.HotSpots[i];break}return e}function rt(t,e,i){var n=t.ImagePath.replace(_t,Dt+"pano/");return Ft.load(n,function(n){n.minFilter=THREE.LinearFilter;var o=new THREE.PlaneBufferGeometry(t.Width,t.Height,1,1),a=new THREE.MeshBasicMaterial({map:n,side:THREE.BackSide,alphaTest:.1});a.transparent=!0,a.depthWrite=!0;var r=new THREE.Mesh(o,a);r.rotation.reorder("YXZ"),r.rotation.set(THREE.Math.degToRad(t.Rotation.x),THREE.Math.degToRad(t.Rotation.y),THREE.Math.degToRad(t.Rotation.z)),r.position.set(t.Position.x,t.Position.y,-t.Position.z),t.facePlane=r,e.add(r);var s=r.clone();i.add(s)},function(e){ct(t,e)})}function st(t){if(gt("setOverviewCameraControllerDistance"),void 0!=xe&&void 0!=Pe){var e=Math.min(xe.x,xe.z)*wi*.0025;Pe.minDistance=370*e,Pe.maxDistance=900*e,t&&(Pe.minDistance-=80*e,Pe.maxDistance-=200*e)}}function lt(t){var e=650*Math.cos(THREE.Math.degToRad(60)),i=Math.sin(THREE.Math.degToRad(60))*e,n=650*Math.sin(THREE.Math.degToRad(60)),o=-Math.cos(THREE.Math.degToRad(60))*e,a=Math.max(xe.x,xe.z)*wi*.002,r=new THREE.Vector3(i*a,n*a,o*a);t&&(r.x+=100*a,r.y-=50*a,r.z+=100*a),Ot.position.copy(r)}function dt(t){var e,i,n,o,a,r;for(var s in t.Rooms){var l=t.Rooms[s];for(var d in l.RoomFaces){var c=l.RoomFaces[d];0==s&&0==d?(e=i=l.Position.x+c.Position.x,n=o=l.Position.y+c.Position.y,a=r=l.Position.z+c.Position.z):(e=Math.min(e,l.Position.x+c.Position.x),i=Math.max(i,l.Position.x+c.Position.x),n=Math.min(n,l.Position.y+c.Position.y),o=Math.max(o,l.Position.y+c.Position.y),a=Math.min(a,-l.Position.z-c.Position.z),r=Math.max(r,-l.Position.z-c.Position.z))}}return new THREE.Vector3(i-e,o-n,r-a)}function ct(t,e){t.loadedProgress=e.loaded/e.total;var i=0;for(var n in Re.Rooms){var o=Re.Rooms[n];for(var a in o.RoomFaces){var r=o.RoomFaces[a];void 0==r.loadedProgress&&(r.loadedProgress=0),i+=r.loadedProgress}}100==parseInt(i/Hi*100)&&setTimeout(ut,500)}function ut(){console.log("on3DHousePrepared"),qe=!0,me=!0,et(!1),Q()}function mt(){console.log("ResoucePrepared"),St(!0);var t=Re.HotSpots[0];z(t),kt(t.thumbnailElement,!1),r(),document.getElementById("welcome").style.visibility="hidden",$("#controlTip")[0].style.visibility="visible",setTimeout(function(){$("#controlTip").fadeOut(3e3)},2e3),document.getElementById("controlDiv").style.visibility="visible",it()}function pt(){Pi=!Pi,Pi?T()?ht(!0):(bi.style.visibility="visible",bi.style.opacity=1,$("#vrStartTip").stop(),$("#vrStartTip").show(),Me.enabled=!1,$("#vrStartTip").fadeOut(5e3)):ht(!1)}function vt(t){var e=RegExp("[?&]"+t+"=([^&]*)").exec(window.location.search);return e&&decodeURIComponent(e[1].replace(/\+/g," "))}function ht(t){Ot.fov=t?mi:ui,Si=t,Ve.visible=t,t?Et():ft(),Mi&&(t?Me.enabled=!0:di&&(Me.enabled=!1))}function Et(){di?(Pe.enabled=!1,Ot.position.x=100,Ot.position.y=250,Ot.position.z=300):(Me.enabled=!1,$("#vrStartTip").stop()),bi.style.visibility="hidden"}function ft(){di?(Pe.enabled=!0,Pe.update()):(Ot.rotation.z=0,Me.enabled=!0,tt(),Q(),Me.updateRotation()),void 0!=Ae&&clearTimeout(Ae),bi.style.visibility="hidden"}function gt(t){Ue&&(Je+=t,Je+="\n",yi.value=Je)}function bt(t,e){var i=yt(t,e),n=new THREE.SpriteMaterial({map:i}),o=new THREE.Sprite(n);return o.scale.set(i.scaleX,i.scaleY,1),o}function yt(t,e){void 0===e&&(e={});var i=e.hasOwnProperty("fontface")?e.fontface:"Arial",n=e.hasOwnProperty("fontsize")?e.fontsize:18,o=e.hasOwnProperty("borderThickness")?e.borderThickness:0,a=e.hasOwnProperty("borderColor")?e.borderColor:{r:0,g:0,b:0,a:1},r=e.hasOwnProperty("backgroundColor")?e.backgroundColor:{r:255,g:255,b:255,a:1},s=e.hasOwnProperty("cornerAngle")?e.cornerAngle:10,l=document.createElement("canvas");l.width=12*n,l.height=1.4*n;var d=l.getContext("2d");d.font="normal "+n+"px "+i,d.textAlign="center",d.textBaseline="middle";var c=d.measureText(t),u=c.width,m=(l.width+o)/2,p=(l.height+o)/2;d.fillStyle="rgba("+r.r+","+r.g+","+r.b+","+r.a+")",d.strokeStyle="rgba("+a.r+","+a.g+","+a.b+","+a.a+")",d.lineWidth=o;Tt(d,(l.width-u-100)/2,0,u+100,l.height,s),d.fillStyle="rgba(255, 255, 255, 1.0)",d.fillText(t,m,p);var v=new THREE.Texture(l);return v.minFilter=THREE.LinearFilter,v.needsUpdate=!0,v.parameters=e,v.scaleX=.05*l.width,v.scaleY=.05*l.height,v}function wt(t,e){var i=yt(e,t.material.map.parameters);t.material.map.dispose(),t.material.map=i}function Tt(t,e,i,n,o,a){t.beginPath(),t.moveTo(e+a,i),t.lineTo(e+n-a,i),t.quadraticCurveTo(e+n,i,e+n,i+a),t.lineTo(e+n,i+o-a),t.quadraticCurveTo(e+n,i+o,e+n-a,i+o),t.lineTo(e+a,i+o),t.quadraticCurveTo(e,i+o,e,i+o-a),t.lineTo(e,i+a),t.quadraticCurveTo(e,i,e+a,i),t.closePath(),t.fill(),t.stroke()}function Rt(t){function e(){var t=Date.now()/1e3,i=.8+.2*Math.sin(5*t),n=.25*i;r.scale.set(n,n,n);var o=.6*i;d.scale.set(o,o,o);var a=i;u.scale.set(a,a,a),requestAnimationFrame(e)}var i=function(t){kt(t.parent.parent.tag.thumbnailElement,!0)},n=new THREE.SpriteMaterial({opacity:0}),o=new THREE.Sprite(n);o.scale.set(10,10,1),x(o,i);var a=new THREE.SpriteMaterial({map:t,opacity:1}),r=new THREE.Sprite(a);o.add(r);var s=.25;r.scale.set(s,s,1);var l=new THREE.SpriteMaterial({map:t,opacity:.6}),d=new THREE.Sprite(l);o.add(d),s=.75,d.scale.set(s,s,1);var c=new THREE.SpriteMaterial({map:t,opacity:.2}),u=new THREE.Sprite(c);return o.add(u),s=1,u.scale.set(s,s,1),e(),o}function Ht(){"none"==$("#thumbnail-list")[0].style.display?$("#thumbnail-list").slideDown("slow"):$("#thumbnail-list").slideUp("slow")}function xt(){this.imagePath,this.name,this.onclick,this.isSelected=!1,this.click=function(){this.onclick&&this.onclick(this)}}function St(t){$("#thumbnail-controller")[0].style.visibility=t?"visible":"hidden";var e=Pt(),i=$("#thumbnail");for(var n in e){var o=i.clone().appendTo("#thumbnail-list");if(o.find("#thumbnail-name")[0].innerText=e[n].name,o.find("#thumbnail-image")[0].src=e[n].imagePath,o[0].onclick=function(){kt($(this),!0)},o[0].thumbnailData=e[n],!ji){li[n].tag.thumbnailElement=o}}i.remove()}function Pt(){var t=[];for(var e in Re.HotSpots){var i=Re.HotSpots[e],n=Mt(i);0==e&&(n.isSelected=!0),t.push(n)}return t}function Mt(t){var e=Dt+We+"/ThumbnailImages/"+t.ImagePath.substring(t.ImagePath.lastIndexOf("/")+1),i=new xt;return i.name=t.Name.split("-")[0],i.imagePath=e,i.onclick=function(){z(t,C(t))},i}function kt(t,e){t[0].children[0].classList.remove("thumbnail-unselected"),t[0].children[0].classList.add("thumbnail-selected"),t.siblings().each(function(t,e){e.children[0].classList.remove("thumbnail-selected"),e.children[0].classList.add("thumbnail-unselected"),e.thumbnailData&&(e.thumbnailData.isSelected=!1)});var i=t[0].thumbnailData;i.isSelected=!0,e&&i.click()}function jt(){console.log("a"),document.getElementById("switchToOverviewDiv").addEventListener("click",I),document.getElementById("switchVRButton").addEventListener("click",pt),document.getElementById("zoomInDiv").addEventListener("click",J),document.getElementById("zoomOutDiv").addEventListener("click",K),document.getElementById("switchToHotSpotViewDiv").addEventListener("click",j),document.getElementById("thumbnail-control-button").addEventListener("click",Ht)}var It=i(2),_t="http://vrhouse.oss-cn-shanghai.aliyuncs.com/";_t="./house/22544f76-25cf-42db-aa44-53f309567dcf/";var Dt="http://vrhouse.oss-cn-shanghai.aliyuncs.com/";Dt="./house/",Dt="http://ocnvj4kt8.bkt.clouddn.com/";var Bt,Lt,Ct,zt,Ot,Nt,Ft,Vt,At,Gt,Wt,Xt,$t,Yt,qt,Ut,Zt,Jt,Kt,Qt,te,ee,ie,ne,oe,ae,re,se,le,de,ce,ue,me,pe,ve,he,Ee,fe,ge,be,ye,we,Te,Re,He,xe,Se,Pe,Me,ke,je,Ie,_e,De,Be,Le,Ce,ze,Oe,Ne,Fe,Ve,Ae,Ge,We,Xe,$e,Ye=!1,qe=(new THREE.Vector3,new THREE.Vector3,!1),Ue=!1,Ze=!1,Je="",Ke=!0,Qe=!1,ti=[],ei=document.getElementById("vr_house_container"),ii="_overViewHotSpotName",ni="_hotSpotName",oi="_hotSpotLine",ai=[],ri=[],si=[],li=[],di=!0,ci=!1,ui=100,mi=93,pi=document.getElementById("zoomInDiv"),vi=document.getElementById("zoomOutDiv"),hi=document.getElementById("switchToOverviewDiv"),Ei=document.getElementById("switchToHotSpotViewDiv"),fi=document.getElementById("switchVRButton"),gi=(document.getElementById("switchFullscreenButton"),document.getElementById("enterHotSpotTip")),bi=document.getElementById("vrStartTip"),yi=document.getElementById("debugText"),wi=1,Ti=!0,Ri=!0,Hi=0,xi=!0,Si=!1,Pi=!1,Mi=!1,ki=!1,ji=!1;if(function(){try{var t=document.createElement("canvas");return!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){return!1}}())(function(){We=vt("hid"),We="22544f76-25cf-42db-aa44-53f309567dcf",We="pano",Xe=Dt+We+"/PanoramaTileImages/",$e=Dt+We+"/PanoramaBlurTileImages/";var t=vt("mode");Ue&&(yi.style.visibility="visible",gt(yi.style.visibility)),"single"==t&&(ki=!0,ji=!0);(function(t,e,i,n){var o=new XMLHttpRequest;o.open(t,e),o.send(JSON.stringify(i)),o.onreadystatechange=function(t,e){4===this.readyState&&200===this.status?n&&n(this.responseText):200!==this.status&&n&&n(null)}})("get","./house/ViewData.txt","",function(t){null!==t?(Re=JSON.parse(t),document.title=Re.Name+"(极速版)",ji?0==Re.HotSpots.length?document.getElementById("loading_tip").innerHTML="没有全景图片":n():o()):document.getElementById("loading_tip").innerHTML="您要浏览的房子不存在"})})();else{(function(){var t,e=navigator.userAgent,i=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];/trident/i.test(i[1])?(t=/\brv[ :]+(\d+)/g.exec(e)||[],t[1]):"Chrome"===i[1]&&null!=(t=e.match(/\bOPR|Edge\/(\d+)/))?t[1]:(i=i[2]?[i[1],i[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(t=e.match(/version\/(\d+)/i))&&i.splice(1,1,t[1]),i[0],i[1])})();document.getElementById("loading_tip").innerHTML="请升级您的浏览器版本"}},function(t,e){var i=function(t,e){function i(t,e){p=!0,v=t,h=e,f=E,b=g}function n(t,e){p&&y.enabled&&(E=.1*(v-t)+f,g=.1*(e-h)+b)}function o(){p=!1}function a(t){t.preventDefault(),t.stopPropagation(),i(t.touches[0].pageX*w,t.touches[0].pageY*w)}function r(t){t.preventDefault(),t.stopPropagation(),n(t.touches[0].pageX*w,t.touches[0].pageY*w)}function s(t){t.preventDefault(),t.stopPropagation(),o()}function l(t){t.preventDefault(),i(t.clientX,t.clientY),document.addEventListener("mousemove",d,!1),document.addEventListener("mouseup",c,!1)}function d(t){t.preventDefault(),n(t.clientX,t.clientY)}function c(t){t.preventDefault(),o(),document.removeEventListener("mousemove",d,!1),document.removeEventListener("mouseup",c,!1)}function u(){y.enabled&&(y.isAutoPlay&&!p&&(E+=.05),g=Math.max(-18,Math.min(85,g)),t.rotation.x=THREE.Math.degToRad(g),t.rotation.y=-THREE.Math.degToRad(E))}function m(){requestAnimationFrame(m),u()}this.enabled=!1,this.isAutoPlay=!1;var p=!1,v=0,h=0,E=0,f=0,g=0,b=0,y=this,w=3;t.target=new THREE.Vector3(0,0,0),null!=e&&void 0!=e||(e=document),e.addEventListener("mousedown",l,!1),e.addEventListener("mousemove",d,!1),e.addEventListener("mouseup",c,!1),e.addEventListener("touchstart",a,!1),e.addEventListener("touchend",s,!1),e.addEventListener("touchmove",r,!1),m(),this.updateRotation=function(){E=THREE.Math.radToDeg(-t.rotation.y),g=THREE.Math.radToDeg(t.rotation.x),u()}};t.exports=i}])});
//# sourceMappingURL=pano.min.js.map