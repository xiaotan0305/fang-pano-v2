(function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("pano",[],t):"object"==typeof exports?exports.pano=t():e.pano=t()})(this,function(){return function(e){function t(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var i={};return t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([,function(e,t,i){function n(){ni=!1,oi=!0,a(),h(),m(),Hi||f(),b(),k()}function o(){a(),v(),h(),m(),te(),f(),b();var e=w();ve("init3DHouse,isLandscape: "+e),oe(e),ae(e),A()}function a(){$e=qe=425,Ue=30,st=window.innerWidth,lt=window.innerHeight,xt=d(),je=new THREE.TextureLoader,_e=new THREE.Raycaster,Ie=new THREE.Vector2,De=new THREE.Scene;var e=new THREE.SphereBufferGeometry(3e3,1,1),t=new THREE.MeshPhongMaterial({color:3948353,specular:1118481,side:THREE.BackSide});ze=new THREE.Mesh(e,t),De.add(ze),Ce=new THREE.PerspectiveCamera(ai,st/lt,.5,1e5),Ce.rotation.reorder("YXZ"),De.add(Ce),tt=!1,et=2,Hi||(dt=new THREE.Scene,dt.visible=!1,ct=new THREE.PerspectiveCamera(35,$e/qe,.5,1e5),ct.rotation.reorder("YXZ"),ct.position.z=1,Le=new THREE.Scene,Le.visible=!1,Ne=new THREE.OrthographicCamera(-st/2,st/2,lt/2,-lt/2,1,10),Ne.position.z=10,Oe=new THREE.Group,Le.add(Oe),Fe=new THREE.Group,Le.add(Fe)),Be=new THREE.WebGLRenderer,Be.antialias=!0,Be.sortObjects=!1,Be.setPixelRatio(xt?4:2),Be.setSize(st,lt),Be.gammaInput=!0,Be.gammaOutput=!0,Be.autoClear=!1,Zt.appendChild(Be.domElement),At&&(Me=new Stats,Zt.appendChild(Me.dom)),Bt=new THREE.VRControls(Ce),jt=new THREE.StereoEffect(Be),jt.setSize(st,lt),E(),c()}function r(){ut.rotation.x=.5,mt=.7,pt=-30,vt=-.5,Et=-38/13,ht=13;var e=Pe+Ot+"/FloorPlans/"+Ot+".png";je.load(e,s),Ge=new THREE.Group,Ge.visible=!1,Oe.add(Ge),Ae=Ee("",{fontsize:50,backgroundColor:{r:0,g:0,b:0,a:.498039},cornerAngle:12}),Ae.scale.set(210,30,1),Ae.visible=!1,Ge.add(Ae)}function s(e){var t=500/Math.max(bt.x,bt.z),i=.0011*t;ut.scale.set(i,i,i);var n=1.1*t;Ge.scale.set(n,n,n),je.load("src/textures/button_Auto.png"),je.load("src/textures/button_2D_pressed.png"),je.load("src/textures/button_3D_pressed.png");var o=je.load("src/textures/button_Auto_pressed.png"),a=new THREE.SpriteMaterial({map:o});at=new THREE.Sprite(a),at.scale.set(50,25,1),S(at,q),Fe.add(at);var r=je.load("src/textures/button_2D.png"),s=new THREE.SpriteMaterial({map:r});nt=new THREE.Sprite(s),nt.scale.set(40,25,1),S(nt,W),Fe.add(nt);var d=je.load("src/textures/button_3D.png"),c=new THREE.SpriteMaterial({map:d});ot=new THREE.Sprite(c),ot.scale.set(40,25,1),S(ot,X),Fe.add(ot);var u=je.load("src/textures/sector.png"),m=new THREE.SpriteMaterial({map:u});ke=new THREE.Sprite(m),ke.scale.set(100,100,1),ke.material.opacity=.5,Ge.add(ke),it=Ce.rotation.y;var p=je.load("src/textures/hotSpotPoint.png"),v=new THREE.SpriteMaterial({map:p});for(var E in ii){var h=ii[E].tag,f=new THREE.Sprite(v);f.tag=h,f.name=ii[E].tagName,f.material.opacity=.7,f.scale.set(30,30,1),f.position.set(ii[E].position.x*mt,-ii[E].position.z*mt,1),h.floorPlanPosition=f.position.clone(),S(f,function(e){He(e.tag.thumbnailElement,!0)}),Ge.add(f)}var g=new THREE.SpriteMaterial({map:e});We=new THREE.Sprite(g);var b=.8*t;We.scale.set(bt.x*b,bt.z*b,1),We.material.opacity=.9,We.visible=!1,Oe.add(We);var y=je.load("src/textures/bg.png",function(){Le.visible=!0;for(var e in ft.Rooms){var t=ft.Rooms[e];for(var i in t.RoomFaces){ne(t.RoomFaces[i],gt.children[e],ut.children[e])}}}),T=new THREE.SpriteMaterial({map:y});Ye=new THREE.Sprite(T),Ye.material.opacity=.5,Ye.material.color=16777215,Ye.scale.set($e,Ue,1),Fe.add(Ye);var w=new THREE.SpriteMaterial({map:y});Xe=new THREE.Sprite(w),Xe.material.opacity=.5,Xe.material.color=0,Xe.scale.set($e,qe,1),S(Xe,I),Oe.add(Xe),l();for(var E in ii)if(ii[E].tag==St){Ae.position.set(ii[E].tag.floorPlanPosition.x+ht,ii[E].tag.floorPlanPosition.y+ht*Et,1),fe(Ae,ii[E].tag.Name.split("-")[0]),ke.position.set(ii[E].position.x*mt,-ii[E].position.z*mt,1);break}K(!0)}function l(){st=window.innerWidth,lt=window.innerHeight,Ze=st/$e*.4,st>lt&&(Ze=lt/qe*.4),Oe.scale.set(Ze,Ze,1),Oe.position.set(($e*Ze-st)/2,(lt-qe*Ze)/2,1),void 0!=Ye&&(Ye.scale.set($e*Ze,Ue,1),ot.position.set(($e*Ze-25-20)/2,0,1),nt.position.set(ot.position.x-45,0,1),at.position.set(nt.position.x-50,0,1)),Fe.position.set(($e*Ze-st)/2,lt/2-qe*Ze-Ue/2-.5,1)}function d(){var e=navigator.userAgent.toLowerCase(),t="ipad"==e.match(/ipad/i),i="iphone os"==e.match(/iphone os/i),n="midp"==e.match(/midp/i),o="rv:1.2.3.4"==e.match(/rv:1.2.3.4/i),a="ucweb"==e.match(/ucweb/i),r="android"==e.match(/android/i),s="windows ce"==e.match(/windows ce/i),l="windows mobile"==e.match(/windows mobile/i);return t||i||n||o||a||r||s||l}function c(){st==window.innerWidth&&lt==window.innerHeight||(st=window.innerWidth,lt=window.innerHeight,ve("R_SCREEN_WIDTH:"+st),ve("R_SCREEN_HEIGHT"+lt),g()),At&&Me.update(),Z(),Ce.updateProjectionMatrix(),requestAnimationFrame(c);for(var e in ii)ii[e].rotation.y=Ce.rotation.y;if(void 0!=ut&&dt.visible&&($t?ut.rotation.y-=.0025:ut.rotation.y=-Ce.rotation.y),We&&(it!=Ce.rotation.y&&Yt&&!ni&&(it=Ce.rotation.y,J(),U(),K(!0)),We.visible)){ke.material.rotation=Ce.rotation.y-.6,_e.setFromCamera(Ie,Ne);var t=_e.intersectObjects(ei);t.length>0&&void 0!=t[0].object.tag?(Ve=t[0].object,Ae.position.set(Ve.position.x+ht,Ve.position.y+ht*Et,1),fe(Ae,Ve.name)):void 0!=St&&(Ae.position.set(St.floorPlanPosition.x+ht,St.floorPlanPosition.y+ht*Et,1),fe(Ae,St.Name.split("-")[0]))}Be.clear(),Be.clearDepth(),Ti?(wi||Bt.update(),yi?(jt.render(De,Ce),_()):u()):(u(),Tt.enabled&&Tt.update())}function u(){Hi?Be.render(De,Ce):(Be.setViewport(0,lt-qe*Ze,$e*Ze,qe*Ze),Be.render(dt,ct),Be.setViewport(0,0,st,lt),Be.render(De,Ce),Be.render(Le,Ne))}function m(){zt=new THREE.Mesh(new THREE.RingGeometry(.02,.04,32),new THREE.MeshBasicMaterial({color:16777215,opacity:.5,transparent:!0})),zt.visible=!1,zt.position.z=-2,Ce.add(zt)}function p(e){for(var t in ti)ti[t].visible=e;if(e&&Ri){var i=$("#thumbnail-list").children("#thumbnail");for(var t in i)if(i[t].thumbnailData.isSelected){i[t].onclick();break}}}function v(){var e;De.add(new THREE.AmbientLight(6710886)),e=new THREE.DirectionalLight(14674943,.3),e.position.set(0,200,0),e.position.multiplyScalar(1.3),e.castShadow=!0,e.shadow.mapSize.width=1024,e.shadow.mapSize.height=1024;var t=300;e.shadow.camera.left=-t,e.shadow.camera.right=t,e.shadow.camera.top=t,e.shadow.camera.bottom=-t,e.shadow.camera.far=1e3,De.add(e)}function E(){Ke=!1,Je=2.5,Tt=new THREE.OrbitControls(Ce,Be.domElement),Tt.maxPolarAngle=THREE.Math.degToRad(90),Tt.minPolarAngle=THREE.Math.degToRad(10),Tt.autoRotate=bi,Tt.autoRotateSpeed=1,Tt.zoomSpeed=.5,Tt.enableDamping=!0,Tt.dampingFactor=.8,wt=new xe(Ce,Be.domElement),wt.enabled=!1}function h(){for(var e=[],t=0;t<6;t++)e.push(new THREE.MeshBasicMaterial({side:THREE.BackSide}));Rt=new THREE.Mesh(new THREE.CubeGeometry(5e3,5e3,5e3),new THREE.MultiMaterial(e)),Rt.visible=!1,ze.visible=!0;var i=je.load("src/textures/logo.png");i.minFilter=THREE.NearestFilter;var n=new THREE.PlaneBufferGeometry(300,300,1,1),o=new THREE.MeshBasicMaterial({map:i,transparent:!0});yt=new THREE.Mesh(n,o),yt.rotation.x=THREE.Math.degToRad(270),yt.position.y=-400,Rt.add(yt),De.add(Rt)}function f(){var e=je.load("src/textures/hotspot/feet.png"),t=je.load("src/textures/hotspot_sprite.png");e.minFilter=THREE.NearestFilter;var i=new THREE.MeshBasicMaterial({map:e,transparent:!0}),n=4.5-ft.CameraHeight,o=je.load("src/textures/hotspot/light.png");o.minFilter=THREE.NearestFilter;var a=new THREE.CylinderGeometry(12,12,70,30,1,!0),r=new THREE.MeshBasicMaterial({map:o,transparent:!0,depthWrite:!1,side:THREE.DoubleSide}),s=[];for(var l in ft.HotSpots){var d=ft.HotSpots[l],c=new THREE.Group,u=new THREE.Vector3(d.Position.x,d.Position.y+n,-d.Position.z);c.position.copy(u),De.add(c),ii.push(c),d.gameObject=c,c.tag=d;var m=d.Name;"Door"==d.Type&&d.Name.split("-").length>2&&(m=d.Name.substring(0,d.Name.lastIndexOf("-"))),"Room"==d.Type&&d.Name.split("-").length>1&&(m=d.Name.split("-")[0]),c.tagName=m,d.IsSecondFloor=d.Position.y>100;var p=new THREE.Mesh(a,r);c.add(p),c.lightObj=p,p.position.set(0,35,0),p.name=d.Name,x(p,function(e){He(e.parent.tag.thumbnailElement,!0)});var v=new THREE.SpriteMaterial({opacity:0}),E=new THREE.Sprite(v);c.add(E),c.clickableGroup=E,E.position.set(0,p.position.y,0);var h=be(t);E.add(h),h.position.set(0,0,0),h.visible=!1,c.circleSprite=h;var f=new THREE.PlaneBufferGeometry(12,12,1,1),g=new THREE.Mesh(f,i);if(g.rotation.x=THREE.Math.degToRad(270),g.position.y=-35,p.add(g),!(m.split("-").length>1||G(s,m))){var b=Ee(m,{fontsize:50,backgroundColor:{r:0,g:0,b:0,a:.498039},cornerAngle:12});E.add(b),b.y=6,b.position.set(0,b.y,0),b.name=d.Name+Jt,b.visible=!1,c.hotSpotNameSprite=b,s.push(m),x(b,function(e){He(e.parent.parent.tag.thumbnailElement,!0)});var y=Ee(m,{fontsize:250,backgroundColor:{r:0,g:0,b:0,a:.498039},cornerAngle:40});c.add(y),y.position.set(0,p.position.y+40,0),y.name=d.Name+Ut,c.overviewHotSpotNameSprite=y,x(y,j);var T=new THREE.LineBasicMaterial({color:32768,linewidth:1}),w=new THREE.Geometry;w.vertices.push(new THREE.Vector3(0,g.position.y,0),new THREE.Vector3(0,p.position.y-7));var R=new THREE.Line(w,T);R.name=Kt,c.nameLine=R,p.add(R)}}}function g(){ve("resizeWindow"),st=window.innerWidth,lt=window.innerHeight,ve("SCREEN_WIDTH:"+st),ve("SCREEN_HEIGHT"+lt),Ce.aspect=st/lt,Ce.updateProjectionMatrix(),Hi||(ct.aspect=$e/qe,ct.updateProjectionMatrix(),Ne.left=-st/2,Ne.right=st/2,Ne.top=lt/2,Ne.bottom=-lt/2,Ne.updateProjectionMatrix(),l()),yi?jt.setSize(st,lt):Be.setSize(st,lt)}function b(){Be.domElement.addEventListener("touchstart",H,!1),Be.domElement.addEventListener("touchend",H,!1),Be.domElement.addEventListener("mousedown",H,!1),Be.domElement.addEventListener("mouseup",H,!1),window.addEventListener("mousemove",R,!1),window.addEventListener("orientationchange",y,!1)}function y(){ve("onOrientionChangeDelay"),T()}function T(e){var t=w();if(ve("onOrientionChange,isLandscape: "+t),void 0!=t){oe(t),Ti&&(t?yi||ue(!0):yi&&ue(!1));var i=document.getElementById("thumbnail-list");if(t)for(var n in i.children)i.children[n].classList.remove("col-xs-3"),i.children[n].classList.add("col-xs-2");else for(var n in i.children)i.children[n].classList.remove("col-xs-2"),i.children[n].classList.add("col-xs-3")}}function w(){var e;return 180==window.orientation||0==window.orientation?e=!1:90!=window.orientation&&-90!=window.orientation||(e=!0),e}function R(e){e.preventDefault(),Ie.x=e.clientX/Be.domElement.clientWidth*2-1,Ie.y=-e.clientY/Be.domElement.clientHeight*2+1}function H(e){if("touchstart"==e.type||"mousedown"==e.type)Mt=(new Date).getTime(),Wt=!0,Hi||(_t=P(e)),ni&&(Tt.autoRotate=!1);else if("touchend"==e.type||"mouseup"==e.type){if(Wt=!1,(new Date).getTime()-Mt<200&&!Hi){var t=P(e);t==_t&&void 0!=_t&&_t.onClick(_t)}ni?(void 0!=Dt&&clearTimeout(Dt),Dt=setTimeout(function(){Tt.autoRotate=bi},3e3)):!$t&&Yt&&U()}}function x(e,t){Qt.push(e),e.onClick=t}function S(e,t){ei.push(e),e.onClick=t}function P(e){var t;e.preventDefault();var i,n;"touchstart"==e.type?(i=e.touches[0].pageX,n=e.touches[0].pageY):"touchend"==e.type?(i=e.changedTouches[0].pageX,n=e.changedTouches[0].pageY):(i=e.clientX,n=e.clientY),Ie.x=i/Be.domElement.clientWidth*2-1,Ie.y=-n/Be.domElement.clientHeight*2+1,_e.setFromCamera(Ie,Ne);var o=_e.intersectObjects(ei);return o.length>0&&Le.visible&&(We.visible&&void 0!=o[0].object.tag||void 0==o[0].object.tag)?t=o[0].object:(_e.setFromCamera(Ie,Ce),o=_e.intersectObjects(Qt),o.length>0&&(t=o[0].object)),t}function M(){var e;_e.setFromCamera({x:0,y:0},Ce);var t=_e.intersectObjects(Qt);return t.length>0&&(e=t[0].object),e}function _(){var e=M();Nt!=e&&(void 0!=Lt&&clearTimeout(Lt),void 0!=e&&(Lt=setTimeout(function(){e.onClick(e)},1500)),Nt=e)}function I(){if(!We.visible){Yt&&J(),Ri?document.getElementById("thumbnail-controller").style.visibility="visible":(document.getElementById("thumbnail-controller").style.visibility="hidden",ee()),ci.style.visibility="visible",si.style.visibility="hidden",li.style.visibility="hidden",mi.style.visibility="visible",ui.style.visibility="hidden",St=null,Ce.position.copy(Ht),Ce.fov=yi?ri:75,Ce.updateProjectionMatrix(),F(),B(!0),C();for(var e in ii){ii[e].scale.set(1,1,1)}Tt.enabled=!0,Tt.autoRotate=bi,Tt.update(),wt.enabled=!1,Rt.visible=!1,ze.visible=!0,gt.visible=!0,fi=!0;for(var e in ii)ii[e].visible=!0;p(!0),ni=!0}}function D(){document.getElementById("thumbnail-controller").style.visibility="visible",ci.style.visibility="hidden",si.style.visibility="visible",li.style.visibility="visible",mi.style.visibility="hidden",ui.style.visibility="visible",B(!1);for(var e in ii)ii[e].visible=!1;Tt.enabled=!1,Tt.autoRotate=!1,wt.enabled=!0,Ht=new THREE.Vector3(Ce.position.x,Ce.position.y,Ce.position.z),Ce.rotation.x=0,Rt.visible=!0,ze.visible=!1,!Hi&&We&&(Le.visible=!0,K(We.visible)),Yt&&U(),oi||(gt.visible=!1),p(!1),ni=!1}function C(){for(var e in ii)ii[e].lightObj.visible=!0,ii[e].circleSprite.visible=!1,ii[e].nameLine.visible=!0}function B(e){for(var t in ii){var i=ii[t].overviewHotSpotNameSprite;if(void 0!=i&&(i.visible=e,ii[t].nameLine=e),e){var n=ii[t].hotSpotNameSprite;n&&(n.visible=!1)}}}function j(e){He(e.parent.tag.thumbnailElement,!0)}function z(e,t,i,n){if(console.log("fisrt:"+e.Name),fi&&St!=e){Pt=e,St=e,fi=!1,void 0!=e.cached&&0!=e.cached||(document.getElementById("loading").style.visibility="visible");var o;o=Hi?e.ImagePath:e.ImagePath.substring(e.ImagePath.lastIndexOf("/")+1),o=o.substring(0,o.lastIndexOf("."));O([kt+o+"_l.jpg",kt+o+"_r.jpg",kt+o+"_u.jpg",kt+o+"_d.jpg",kt+o+"_f.jpg",kt+o+"_b.jpg"],function(i){N(i,e),t&&t()},function(e,t){i&&i(e,t)},function(e){fi=!0,document.getElementById("loading").style.visibility="hidden",n&&n()})}}function L(e,t,i,n){console.log(e.Name);var o;o=Hi?e.ImagePath:e.ImagePath.substring(e.ImagePath.lastIndexOf("/")+1),o=o.substring(0,o.lastIndexOf(".")),O([Ft+o+"_l.jpg",Ft+o+"_r.jpg",Ft+o+"_u.jpg",Ft+o+"_d.jpg",Ft+o+"_f.jpg",Ft+o+"_b.jpg"],function(e){F();for(var i=0;i<Rt.material.materials.length;i++)Rt.material.materials[i].map=e[i];t&&t()},function(e,t){i&&i(e,t)},function(e){fi=!0,document.getElementById("loading").style.visibility="hidden",n&&n()})}function N(e,t){document.getElementById("loading").style.visibility="hidden",ni&&D(),Ce.fov=yi?ri:ai,wt.updateRotation(),F();for(var i=0;i<Rt.material.materials.length;i++)Rt.material.materials[i].map=e[i];if(!Hi){if(Ae){Ae.position.set(St.floorPlanPosition.x+ht,St.floorPlanPosition.y+ht*Et,1),fe(Ae,St.Name.split("-")[0]);for(var n in ii)if(ii[n].tag==St){ke.position.set(ii[n].position.x*mt,-ii[n].position.z*mt,1);break}}var o=new THREE.Vector3(t.Position.x,t.Position.y,-t.Position.z);Ce.position.copy(o),Ce.updateProjectionMatrix(),Rt.position.copy(o),Rt.rotation.y=THREE.Math.degToRad(180-t.Rotation.y),V(t)}hi&&(Ce.rotation.x=0,Ce.rotation.y=Rt.rotation.y,Ce.rotation.z=0,wt.updateRotation(),hi=!1),fi=!0,t.cached=!0}function O(e,t,i,n){for(var o=[],a=0,r=0;r<e.length;r++)(function(r){je.load(e[r],function(i){o[r]=i,++a===e.length&&t&&t(o)},function(e){i&&i(r,e)},n)})(r)}function F(){for(var e=0;e<Rt.material.materials.length;e++)null!=Rt.material.materials[e].map&&(Rt.material.materials[e].map.dispose(),Rt.material.materials[e].map=null)}function k(e,t){var i;i=e?ie(e):ft.HotSpots[0],t||(t=0),L(i,function(){di.style.visibility="hidden",document.getElementById("welcome").style.visibility="hidden",D(),Ce.rotation.y=THREE.Math.degToRad(t),wt.updateRotation(),Ri&&Te(!0)},function(e,t){qt[e]=t.loaded/t.total;var i=0;for(var n in qt)void 0==qt[n]&&(qt[n]=0),i+=qt[n];var o=parseInt(i/6*100),a=document.getElementById("loading_progress_bar");a.style.width=o+"%",a.innerText=o+"%"},function(){$("#loading_tip").text("加载失败")}),document.getElementById("loading").style.visibility="hidden"}function A(){z(ft.HotSpots[0],de,function(e,t){qt[e]=t.loaded/t.total;var i=0;for(var n in qt)void 0==qt[n]&&(qt[n]=0),i+=qt[n];var o=parseInt(i/6*100),a=document.getElementById("loading_progress_bar");a.style.width=o+"%",a.innerText=o+"%"},function(){$("#loading_tip").text("加载失败")}),document.getElementById("loading").style.visibility="hidden"}function V(e){var t=[];for(var i in e.VisibleHotSpots)t.push(ie(e.VisibleHotSpots[i]));for(var i in ii)if(e==ii[i].tag)ii[i].visible=!1;else{var n=G(t,ii[i].tag);ii[i].visible=n,ii[i].lightObj.visible=!1,ii[i].circleSprite.visible=n;var o=ii[i].hotSpotNameSprite;if(!o)continue;if(o.visible=n,n){var a=Ce.position.distanceTo(ii[i].position.clone().add(o.position)),r=.08*a;ii[i].circleSprite.scale.set(r,r,r),r=.015*a;var o=ii[i].hotSpotNameSprite;o.scale.set(o.material.map.scaleX*r,o.material.map.scaleY*r,1),o.position.y=o.y*r}}}function G(e,t){for(var i=e.length;i--;)if(e[i]===t)return!0;return!1}function W(){Y(!1),K(!0),nt.material.map=je.load("src/textures/button_2D_pressed.png"),ot.material.map=je.load("src/textures/button_3D.png")}function X(){Y(!1),K(!1),nt.material.map=je.load("src/textures/button_2D.png"),ot.material.map=je.load("src/textures/button_3D_pressed.png")}function Y(e){e?(at.material.map=je.load("src/textures/button_Auto_pressed.png"),U(),Yt=!0):(J(),Yt=!1,at.material.map=je.load("src/textures/button_Auto.png"))}function q(){Yt?(Y(!1),We.visible?nt.material.map=je.load("src/textures/button_2D_pressed.png"):ot.material.map=je.load("src/textures/button_3D_pressed.png")):(We.visible?nt.material.map=je.load("src/textures/button_2D.png"):ot.material.map=je.load("src/textures/button_3D.png"),Y(!0))}function Z(){Ke&&(Je>0&&Ce.fov>=Qe||Je<0&&Ce.fov<=Qe?Ke=!1:Ce.fov+=Je)}function U(){void 0!=Ct&&clearTimeout(Ct),Ct=setTimeout(function(){Wt||($t=!0,K(!Vt))},6e3)}function J(){console.log("stopAutoPlay"),void 0!=Ct&&clearTimeout(Ct),$t=!1}function K(e){Hi||(We.visible=e,Ge.visible=e,dt.visible=!e,rt=!e)}function Q(){}function ee(){dt.visible=!1,Le.visible=!1,J()}function te(){It=ft.HotSpots.length,gt=new THREE.Object3D,gt.name=ft.Name,De.add(gt),ut=gt.clone(),dt.add(ut);for(var e in ft.Rooms){var t=ft.Rooms[e],i=new THREE.Object3D;i.name=t.Name,i.position.set(t.Position.x,t.Position.y,-t.Position.z),i.rotation.set(0,THREE.Math.degToRad(-t.Rotation),0),gt.add(i),ti.push(i),t.gameObject=i,t.IsSecondFloor||(t.IsSecondFloor=t.Position.y>100);var n=i.clone();ut.add(n);for(var o in t.RoomFaces)gi++}return gt.scale.set(Ei,Ei,Ei),bt=re(ft),ft}function ie(e){var t;for(var i in ft.HotSpots)if(ft.HotSpots[i].Name==e){t=ft.HotSpots[i];break}return t}function ne(e,t,i){var n=e.ImagePath.replace(Se,Pe);return je.load(n,function(n){n.minFilter=THREE.LinearFilter;var o=new THREE.PlaneBufferGeometry(e.Width,e.Height,1,1),a=new THREE.MeshBasicMaterial({map:n,side:THREE.BackSide,alphaTest:.1});a.transparent=!0,a.depthWrite=!0;var r=new THREE.Mesh(o,a);r.rotation.reorder("YXZ"),r.rotation.set(THREE.Math.degToRad(e.Rotation.x),THREE.Math.degToRad(e.Rotation.y),THREE.Math.degToRad(e.Rotation.z)),r.position.set(e.Position.x,e.Position.y,-e.Position.z),e.facePlane=r,t.add(r);var s=r.clone();i.add(s)},function(t){se(e,t)})}function oe(e){if(ve("setOverviewCameraControllerDistance"),void 0!=bt&&void 0!=Tt){var t=Math.min(bt.x,bt.z)*Ei*.0025;Tt.minDistance=370*t,Tt.maxDistance=900*t,e&&(Tt.minDistance-=80*t,Tt.maxDistance-=200*t)}}function ae(e){var t=650*Math.cos(THREE.Math.degToRad(60)),i=Math.sin(THREE.Math.degToRad(60))*t,n=650*Math.sin(THREE.Math.degToRad(60)),o=-Math.cos(THREE.Math.degToRad(60))*t,a=Math.max(bt.x,bt.z)*Ei*.002,r=new THREE.Vector3(i*a,n*a,o*a);e&&(r.x+=100*a,r.y-=50*a,r.z+=100*a),Ce.position.copy(r)}function re(e){var t,i,n,o,a,r;for(var s in e.Rooms){var l=e.Rooms[s];for(var d in l.RoomFaces){var c=l.RoomFaces[d];0==s&&0==d?(t=i=l.Position.x+c.Position.x,n=o=l.Position.y+c.Position.y,a=r=l.Position.z+c.Position.z):(t=Math.min(t,l.Position.x+c.Position.x),i=Math.max(i,l.Position.x+c.Position.x),n=Math.min(n,l.Position.y+c.Position.y),o=Math.max(o,l.Position.y+c.Position.y),a=Math.min(a,-l.Position.z-c.Position.z),r=Math.max(r,-l.Position.z-c.Position.z))}}return new THREE.Vector3(i-t,o-n,r-a)}function se(e,t){e.loadedProgress=t.loaded/t.total;var i=0;for(var n in ft.Rooms){var o=ft.Rooms[n];for(var a in o.RoomFaces){var r=o.RoomFaces[a];void 0==r.loadedProgress&&(r.loadedProgress=0),i+=r.loadedProgress}}100==parseInt(i/gi*100)&&setTimeout(le,500)}function le(){console.log("on3DHousePrepared"),Vt=!0,rt=!0,K(!1),U()}function de(){console.log("ResoucePrepared"),Te(!0);var e=ft.HotSpots[0];L(e),He(e.thumbnailElement,!1),r(),document.getElementById("welcome").style.visibility="hidden",$("#controlTip")[0].style.visibility="visible",setTimeout(function(){$("#controlTip").fadeOut(3e3)},2e3),document.getElementById("controlDiv").style.visibility="visible",Q()}function ce(e){var t=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))}function ue(e){Ce.fov=e?ri:ai,yi=e,zt.visible=e,e?me():pe(),wi&&(e?wt.enabled=!0:ni&&(wt.enabled=!1))}function me(){ni?(Tt.enabled=!1,Ce.position.x=100,Ce.position.y=250,Ce.position.z=300):(wt.enabled=!1,$("#vrStartTip").stop()),pi.style.visibility="hidden"}function pe(){ni?(Tt.enabled=!0,Tt.update()):(Ce.rotation.z=0,wt.enabled=!0,J(),U(),wt.updateRotation()),void 0!=Lt&&clearTimeout(Lt),pi.style.visibility="hidden"}function ve(e){Gt&&(Xt+=e,Xt+="\n",vi.value=Xt)}function Ee(e,t){var i=he(e,t),n=new THREE.SpriteMaterial({map:i}),o=new THREE.Sprite(n);return o.scale.set(i.scaleX,i.scaleY,1),o}function he(e,t){void 0===t&&(t={});var i=t.hasOwnProperty("fontface")?t.fontface:"Arial",n=t.hasOwnProperty("fontsize")?t.fontsize:18,o=t.hasOwnProperty("borderThickness")?t.borderThickness:0,a=t.hasOwnProperty("borderColor")?t.borderColor:{r:0,g:0,b:0,a:1},r=t.hasOwnProperty("backgroundColor")?t.backgroundColor:{r:255,g:255,b:255,a:1},s=t.hasOwnProperty("cornerAngle")?t.cornerAngle:10,l=document.createElement("canvas");l.width=12*n,l.height=1.4*n;var d=l.getContext("2d");d.font="normal "+n+"px "+i,d.textAlign="center",d.textBaseline="middle";var c=d.measureText(e),u=c.width,m=(l.width+o)/2,p=(l.height+o)/2;d.fillStyle="rgba("+r.r+","+r.g+","+r.b+","+r.a+")",d.strokeStyle="rgba("+a.r+","+a.g+","+a.b+","+a.a+")",d.lineWidth=o;ge(d,(l.width-u-100)/2,0,u+100,l.height,s),d.fillStyle="rgba(255, 255, 255, 1.0)",d.fillText(e,m,p);var v=new THREE.Texture(l);return v.minFilter=THREE.LinearFilter,v.needsUpdate=!0,v.parameters=t,v.scaleX=.05*l.width,v.scaleY=.05*l.height,v}function fe(e,t){var i=he(t,e.material.map.parameters);e.material.map.dispose(),e.material.map=i}function ge(e,t,i,n,o,a){e.beginPath(),e.moveTo(t+a,i),e.lineTo(t+n-a,i),e.quadraticCurveTo(t+n,i,t+n,i+a),e.lineTo(t+n,i+o-a),e.quadraticCurveTo(t+n,i+o,t+n-a,i+o),e.lineTo(t+a,i+o),e.quadraticCurveTo(t,i+o,t,i+o-a),e.lineTo(t,i+a),e.quadraticCurveTo(t,i,t+a,i),e.closePath(),e.fill(),e.stroke()}function be(e){function t(){var e=Date.now()/1e3,i=.8+.2*Math.sin(5*e),n=.25*i;r.scale.set(n,n,n);var o=.6*i;d.scale.set(o,o,o);var a=i;u.scale.set(a,a,a),requestAnimationFrame(t)}var i=function(e){He(e.parent.parent.tag.thumbnailElement,!0)},n=new THREE.SpriteMaterial({opacity:0}),o=new THREE.Sprite(n);o.scale.set(10,10,1),x(o,i);var a=new THREE.SpriteMaterial({map:e,opacity:1}),r=new THREE.Sprite(a);o.add(r);var s=.25;r.scale.set(s,s,1);var l=new THREE.SpriteMaterial({map:e,opacity:.6}),d=new THREE.Sprite(l);o.add(d),s=.75,d.scale.set(s,s,1);var c=new THREE.SpriteMaterial({map:e,opacity:.2}),u=new THREE.Sprite(c);return o.add(u),s=1,u.scale.set(s,s,1),t(),o}function ye(){this.imagePath,this.name,this.onclick,this.isSelected=!1,this.click=function(){this.onclick&&this.onclick(this)}}function Te(e){$("#thumbnail-controller")[0].style.visibility=e?"visible":"hidden";var t=we(),i=$("#thumbnail");for(var n in t){var o=i.clone().appendTo("#thumbnail-list");if(o.find("#thumbnail-name")[0].innerText=t[n].name,o.find("#thumbnail-image")[0].src=t[n].imagePath,o[0].onclick=function(){He($(this),!0)},o[0].thumbnailData=t[n],!Hi){ii[n].tag.thumbnailElement=o}}i.remove()}function we(){var e=[];for(var t in ft.HotSpots){var i=ft.HotSpots[t],n=Re(i);0==t&&(n.isSelected=!0),e.push(n)}return e}function Re(e){var t=Pe+Ot+"/ThumbnailImages/"+e.ImagePath.substring(e.ImagePath.lastIndexOf("/")+1),i=new ye;return i.name=e.Name.split("-")[0],i.imagePath=t,i.onclick=function(){L(e,z(e))},i}function He(e,t){e[0].children[0].classList.remove("thumbnail-unselected"),e[0].children[0].classList.add("thumbnail-selected"),e.siblings().each(function(e,t){t.children[0].classList.remove("thumbnail-selected"),t.children[0].classList.add("thumbnail-unselected"),t.thumbnailData&&(t.thumbnailData.isSelected=!1)});var i=e[0].thumbnailData;i.isSelected=!0,t&&i.click()}var xe=i(2),Se="http://vrhouse.oss-cn-shanghai.aliyuncs.com/",Pe="http://vrhouse.oss-cn-shanghai.aliyuncs.com/";Pe="./house/";var Me,_e,Ie,De,Ce,Be,je,ze,Le,Ne,Oe,Fe,ke,Ae,Ve,Ge,We,Xe,Ye,$e,qe,Ze,Ue,Je,Ke,Qe,et,tt,it,nt,ot,at,rt,st,lt,dt,ct,ut,mt,pt,vt,Et,ht,ft,gt,bt,yt,Tt,wt,Rt,Ht,xt,St,Pt,Mt,_t,It,Dt,Ct,Bt,jt,zt,Lt,Nt,Ot,Ft,kt,At=!1,Vt=(new THREE.Vector3,new THREE.Vector3,!1),Gt=!1,Wt=!1,Xt="",Yt=!0,$t=!1,qt=[],Zt=document.getElementById("vr_house_container"),Ut="_overViewHotSpotName",Jt="_hotSpotName",Kt="_hotSpotLine",Qt=[],ei=[],ti=[],ii=[],ni=!0,oi=!1,ai=100,ri=93,si=document.getElementById("zoomInDiv"),li=document.getElementById("zoomOutDiv"),di=document.getElementById("switchToOverviewDiv"),ci=document.getElementById("switchToHotSpotViewDiv"),ui=document.getElementById("switchVRButton"),mi=(document.getElementById("switchFullscreenButton"),document.getElementById("enterHotSpotTip")),pi=document.getElementById("vrStartTip"),vi=document.getElementById("debugText"),Ei=1,hi=!0,fi=!0,gi=0,bi=!0,yi=!1,Ti=!1,wi=!1,Ri=!1,Hi=!1;if(function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}())(function(){Ot=ce("hid"),Ot="22544f76-25cf-42db-aa44-53f309567dcf",Ft=Pe+Ot+"/PanoramaTileImages/",kt=Pe+Ot+"/PanoramaBlurTileImages/";var e=ce("mode");Gt&&(vi.style.visibility="visible",ve(vi.style.visibility)),"single"==e&&(Ri=!0,Hi=!0);$.ajax({url:"./house/ViewData.txt",type:"GET",success:function(e){ft=JSON.parse(e),document.title=ft.Name+"(极速版)",Hi?0==ft.HotSpots.length?$("#loading_tip").text("没有全景图片"):n():o()},error:function(e){"404"==e.status&&$("#loading_tip").text("您要浏览的房子不存在")}})})();else{(function(){var e,t=navigator.userAgent,i=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];/trident/i.test(i[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],e[1]):"Chrome"===i[1]&&null!=(e=t.match(/\bOPR|Edge\/(\d+)/))?e[1]:(i=i[2]?[i[1],i[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&i.splice(1,1,e[1]),i[0],i[1])})();document.getElementById("loading_tip").innerHTML="请升级您的浏览器版本"}},function(e,t){var i=function(e,t){function i(e,t){p=!0,v=e,E=t,f=h,b=g}function n(e,t){p&&y.enabled&&(h=.1*(v-e)+f,g=.1*(t-E)+b)}function o(){p=!1}function a(e){e.preventDefault(),e.stopPropagation(),i(e.touches[0].pageX*T,e.touches[0].pageY*T)}function r(e){e.preventDefault(),e.stopPropagation(),n(e.touches[0].pageX*T,e.touches[0].pageY*T)}function s(e){e.preventDefault(),e.stopPropagation(),o()}function l(e){e.preventDefault(),i(e.clientX,e.clientY),document.addEventListener("mousemove",d,!1),document.addEventListener("mouseup",c,!1)}function d(e){e.preventDefault(),n(e.clientX,e.clientY)}function c(e){e.preventDefault(),o(),document.removeEventListener("mousemove",d,!1),document.removeEventListener("mouseup",c,!1)}function u(){y.enabled&&(y.isAutoPlay&&!p&&(h+=.05),g=Math.max(-18,Math.min(85,g)),e.rotation.x=THREE.Math.degToRad(g),e.rotation.y=-THREE.Math.degToRad(h))}function m(){requestAnimationFrame(m),u()}this.enabled=!1,this.isAutoPlay=!1;var p=!1,v=0,E=0,h=0,f=0,g=0,b=0,y=this,T=3;e.target=new THREE.Vector3(0,0,0),null!=t&&void 0!=t||(t=document),t.addEventListener("mousedown",l,!1),t.addEventListener("mousemove",d,!1),t.addEventListener("mouseup",c,!1),t.addEventListener("touchstart",a,!1),t.addEventListener("touchend",s,!1),t.addEventListener("touchmove",r,!1),m(),this.updateRotation=function(){h=THREE.Math.radToDeg(-e.rotation.y),g=THREE.Math.radToDeg(e.rotation.x),u()}};e.exports=i}])});
//# sourceMappingURL=pano.min.js.map